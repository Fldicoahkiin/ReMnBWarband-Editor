import { Button, VerticalBox, HorizontalBox, LineEdit, ComboBox, CheckBox, ScrollView, GroupBox, ListView } from "std-widgets.slint";

export component TriggerEditor inherits Rectangle {
    // 回调函数
    callback load_triggers(string);
    callback save_triggers();
    callback trigger_selected(int);
    callback create_new_trigger();
    callback delete_trigger(int);
    callback add_condition_to_trigger(int, string);
    callback add_consequence_to_trigger(int, string);
    callback update_trigger_property(string, string);
    
    // 属性
    in property <string> current_trigger_id: "";
    in property <float> current_trigger_check_period: 0.0;
    in property <float> current_trigger_delay_period: 0.0;
    in property <float> current_trigger_rearm_period: 0.0;
    in property <int> current_trigger_conditions_count: 0;
    in property <int> current_trigger_consequences_count: 0;
    in property <[string]> trigger_list: [];
    in property <int> selected_trigger_index: -1;
    
    background: white;
    
    HorizontalLayout {
        padding: 0px;
        
        // 左侧触发器列表
        Rectangle {
            width: 320px;
            background: #f8fafc;
            border-width: 1px;
            border-color: #e2e8f0;
            
            VerticalLayout {
                padding: 16px;
                spacing: 16px;
                
                // 标题和工具栏
                HorizontalLayout {
                    spacing: 12px;
                    
                    Text {
                        text: "触发器列表";
                        font-size: 18px;
                        font-weight: 600;
                        color: #1f2937;
                        vertical-alignment: center;
                    }
                    
                    Rectangle { } // 弹性空间
                    
                    Button {
                        text: "+";
                        width: 32px;
                        height: 32px;
                        clicked => { root.create_new_trigger(); }
                    }
                }
                
                // 搜索框
                LineEdit {
                    placeholder-text: "搜索触发器...";
                    font-size: 14px;
                }
                
                // 触发器列表
                ScrollView {
                    ListView {
                        for trigger[index] in root.trigger_list: Rectangle {
                            height: 48px;
                            background: index == root.selected_trigger_index ? #3b82f6 : white;
                            border-radius: 6px;
                            
                            HorizontalLayout {
                                padding: 12px;
                                spacing: 12px;
                                
                                Rectangle {
                                    width: 24px;
                                    height: 24px;
                                    background: #8b5cf6;
                                    border-radius: 4px;
                                    
                                    Text {
                                        text: "⚡";
                                        font-size: 12px;
                                        horizontal-alignment: center;
                                        vertical-alignment: center;
                                    }
                                }
                                
                                VerticalLayout {
                                    spacing: 2px;
                                    
                                    Text {
                                        text: trigger;
                                        font-size: 14px;
                                        font-weight: 500;
                                        color: index == root.selected_trigger_index ? white : #374151;
                                    }
                                    
                                    Text {
                                        text: "条件: " + root.current_trigger_conditions_count + " | 结果: " + root.current_trigger_consequences_count;
                                        font-size: 12px;
                                        color: index == root.selected_trigger_index ? #e5e7eb : #6b7280;
                                    }
                                }
                            }
                            
                            TouchArea {
                                clicked => { root.trigger_selected(index); }
                            }
                        }
                    }
                }
                
                // 底部工具栏
                HorizontalLayout {
                    spacing: 8px;
                    
                    Button {
                        text: "加载";
                        clicked => { root.load_triggers("triggers.txt"); }
                    }
                    
                    Button {
                        text: "保存";
                        clicked => { root.save_triggers(); }
                    }
                    
                    Button {
                        text: "删除";
                        enabled: root.selected_trigger_index >= 0;
                        clicked => { root.delete_trigger(root.selected_trigger_index); }
                    }
                }
            }
        }
        
        // 右侧编辑区域
        Rectangle {
            background: white;
            
            VerticalLayout {
                padding: 24px;
                spacing: 24px;
                
                // 标题栏
                HorizontalLayout {
                    Text {
                        text: "触发器编辑器";
                        font-size: 24px;
                        font-weight: 700;
                        color: #111827;
                    }
                    
                    Rectangle { } // 弹性空间
                    
                    Text {
                        text: root.current_trigger_id != "" ? "编辑: " + root.current_trigger_id : "请选择触发器";
                        font-size: 14px;
                        color: #6b7280;
                        vertical-alignment: center;
                    }
                }
                
                ScrollView {
                    VerticalLayout {
                        spacing: 20px;
                        
                        // 基础设置
                        GroupBox {
                            title: "基础设置";
                            
                            VerticalLayout {
                                spacing: 16px;
                                
                                HorizontalLayout {
                                    spacing: 16px;
                                    
                                    VerticalLayout {
                                        spacing: 6px;
                                        
                                        Text {
                                            text: "触发器ID";
                                            font-size: 14px;
                                            font-weight: 500;
                                            color: #374151;
                                        }
                                        
                                        LineEdit {
                                            text: root.current_trigger_id;
                                            placeholder-text: "输入触发器ID...";
                                            edited(text) => {
                                                root.update_trigger_property("id", text);
                                            }
                                        }
                                    }
                                }
                                
                                HorizontalLayout {
                                    spacing: 16px;
                                    
                                    VerticalLayout {
                                        spacing: 6px;
                                        
                                        Text {
                                            text: "检查周期 (秒)";
                                            font-size: 14px;
                                            font-weight: 500;
                                            color: #374151;
                                        }
                                        
                                        LineEdit {
                                            text: root.current_trigger_check_period;
                                            placeholder-text: "0.0";
                                            edited(text) => {
                                                root.update_trigger_property("check_period", text);
                                            }
                                        }
                                    }
                                    
                                    VerticalLayout {
                                        spacing: 6px;
                                        
                                        Text {
                                            text: "延迟周期 (秒)";
                                            font-size: 14px;
                                            font-weight: 500;
                                            color: #374151;
                                        }
                                        
                                        LineEdit {
                                            text: root.current_trigger_delay_period;
                                            placeholder-text: "0.0";
                                            edited(text) => {
                                                root.update_trigger_property("delay_period", text);
                                            }
                                        }
                                    }
                                    
                                    VerticalLayout {
                                        spacing: 6px;
                                        
                                        Text {
                                            text: "重置周期 (秒)";
                                            font-size: 14px;
                                            font-weight: 500;
                                            color: #374151;
                                        }
                                        
                                        LineEdit {
                                            text: root.current_trigger_rearm_period;
                                            placeholder-text: "0.0";
                                            edited(text) => {
                                                root.update_trigger_property("rearm_period", text);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // 触发条件
                        GroupBox {
                            title: "触发条件";
                            
                            VerticalLayout {
                                spacing: 16px;
                                
                                HorizontalLayout {
                                    Text {
                                        text: "条件列表 (" + root.current_trigger_conditions_count + " 个)";
                                        font-size: 16px;
                                        font-weight: 500;
                                        color: #374151;
                                        vertical-alignment: center;
                                    }
                                    
                                    Rectangle { } // 弹性空间
                                    
                                    Button {
                                        text: "添加条件";
                                        clicked => {
                                            root.add_condition_to_trigger(root.selected_trigger_index, "new_condition");
                                        }
                                    }
                                }
                                
                                ScrollView {
                                    height: 200px;
                                    
                                    VerticalLayout {
                                        spacing: 8px;
                                        
                                        // 示例条件项
                                        Rectangle {
                                            height: 40px;
                                            background: #f3f4f6;
                                            border-radius: 6px;
                                            border-width: 1px;
                                            border-color: #d1d5db;
                                            
                                            HorizontalLayout {
                                                padding: 12px;
                                                spacing: 12px;
                                                
                                                Text {
                                                    text: "条件 1: 玩家进入场景";
                                                    font-size: 14px;
                                                    color: #374151;
                                                    vertical-alignment: center;
                                                }
                                                
                                                Rectangle { } // 弹性空间
                                                
                                                Button {
                                                    text: "编辑";
                                                    width: 60px;
                                                    height: 24px;
                                                }
                                                
                                                Button {
                                                    text: "删除";
                                                    width: 60px;
                                                    height: 24px;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // 触发结果
                        GroupBox {
                            title: "触发结果";
                            
                            VerticalLayout {
                                spacing: 16px;
                                
                                HorizontalLayout {
                                    Text {
                                        text: "结果列表 (" + root.current_trigger_consequences_count + " 个)";
                                        font-size: 16px;
                                        font-weight: 500;
                                        color: #374151;
                                        vertical-alignment: center;
                                    }
                                    
                                    Rectangle { } // 弹性空间
                                    
                                    Button {
                                        text: "添加结果";
                                        clicked => {
                                            root.add_consequence_to_trigger(root.selected_trigger_index, "new_consequence");
                                        }
                                    }
                                }
                                
                                ScrollView {
                                    height: 200px;
                                    
                                    VerticalLayout {
                                        spacing: 8px;
                                        
                                        // 示例结果项
                                        Rectangle {
                                            height: 40px;
                                            background: #f3f4f6;
                                            border-radius: 6px;
                                            border-width: 1px;
                                            border-color: #d1d5db;
                                            
                                            HorizontalLayout {
                                                padding: 12px;
                                                spacing: 12px;
                                                
                                                Text {
                                                    text: "结果 1: 显示对话";
                                                    font-size: 14px;
                                                    color: #374151;
                                                    vertical-alignment: center;
                                                }
                                                
                                                Rectangle { } // 弹性空间
                                                
                                                Button {
                                                    text: "编辑";
                                                    width: 60px;
                                                    height: 24px;
                                                }
                                                
                                                Button {
                                                    text: "删除";
                                                    width: 60px;
                                                    height: 24px;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // 操作码编辑器
                        GroupBox {
                            title: "操作码编辑器";
                            
                            VerticalLayout {
                                spacing: 16px;
                                
                                Text {
                                    text: "直接编辑触发器代码";
                                    font-size: 14px;
                                    color: #6b7280;
                                }
                                
                                ScrollView {
                                    height: 150px;
                                    
                                    Rectangle {
                                        background: #1f2937;
                                        border-radius: 6px;
                                        
                                        VerticalLayout {
                                            padding: 12px;
                                            
                                            Text {
                                                text: "# 触发器代码\n(try_begin),\n  (eq, \"$g_mt_mode\", abm_visit),\n  (display_message, \"@进入场景\"),\n(try_end),";
                                                font-size: 12px;
                                                font-family: "Courier New";
                                                color: #e5e7eb;
                                            }
                                        }
                                    }
                                }
                                
                                HorizontalLayout {
                                    spacing: 12px;
                                    
                                    Button {
                                        text: "验证语法";
                                    }
                                    
                                    Button {
                                        text: "格式化代码";
                                    }
                                    
                                    Rectangle { } // 弹性空间
                                    
                                    Button {
                                        text: "编译测试";
                                        primary: true;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
