import { Button, ListView, LineEdit, HorizontalBox, VerticalBox, GroupBox } from "std-widgets.slint";

export struct GamePath {
    path: string,
    name: string,
    is_valid: bool,
    is_selected: bool,
}

export component GameDirectory inherits GroupBox {
    title: "游戏目录";
    
    property <[GamePath]> game_paths: [];
    property <string> current_path: "";
    
    callback detect_games();
    callback browse_folder();
    callback select_path(string);
    callback edit_path(string);
    callback remove_path(string);
    
    VerticalBox {
        spacing: 8px;
        
        // 操作按钮区域
        HorizontalBox {
            spacing: 8px;
            alignment: start;
            
            Button {
                text: "自动检测";
                icon: @image-url("../../assets/Images/icons/TICK.ICO");
                clicked => { root.detect_games(); }
            }
            
            Button {
                text: "浏览文件夹";
                icon: @image-url("../../assets/Images/icons/HAMMER.ICO");
                clicked => { root.browse_folder(); }
            }
        }
        
        // 路径编辑区域
        HorizontalBox {
            spacing: 8px;
            
            LineEdit {
                placeholder-text: "游戏路径";
                text <=> root.current_path;
                min-width: 400px;
                preferred-width: 500px;
            }
            
            Button {
                text: "添加";
                enabled: root.current_path != "";
                clicked => { 
                    root.edit_path(root.current_path);
                    root.current_path = "";
                }
            }
        }
        
        // 游戏路径列表
        ListView {
            for game_path[index] in root.game_paths: Rectangle {
                height: 32px;
                background: game_path.is_selected ? #e3f2fd : (game_path.is_valid ? #f5f5f5 : #ffebee);
                border-radius: 4px;
                
                HorizontalBox {
                    spacing: 8px;
                    padding: 4px;
                
                Rectangle {
                    width: 16px;
                    height: 16px;
                    background: game_path.is_valid ? green : red;
                    border-radius: 8px;
                }
                
                Text {
                    text: game_path.name;
                    font-weight: game_path.is_selected ? 700 : 400;
                    color: game_path.is_valid ? #333 : #666;
                    horizontal-alignment: left;
                    vertical-alignment: center;
                }
                
                Rectangle { } // 占位符，推动按钮到右侧
                
                Button {
                    text: "选择";
                    enabled: game_path.is_valid;
                    clicked => { root.select_path(game_path.path); }
                }
                
                Button {
                    text: "删除";
                    clicked => { root.remove_path(game_path.path); }
                }
                
                    TouchArea {
                        clicked => { 
                            if (game_path.is_valid) {
                                root.select_path(game_path.path);
                            }
                        }
                    }
                }
            }
        }
    }
}
