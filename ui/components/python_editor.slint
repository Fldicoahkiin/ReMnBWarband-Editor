import { Button, VerticalBox, HorizontalBox, LineEdit, ComboBox, ScrollView, GroupBox, ListView } from "std-widgets.slint";

export component PythonEditor inherits Rectangle {
    // å›žè°ƒå‡½æ•°
    callback execute_python_code(string) -> string;
    callback execute_python_file(string) -> string;
    callback get_python_templates() -> [string];
    callback clear_python_history();
    callback get_python_info() -> string;
    callback load_python_template(string);
    
    // å±žæ€§
    in property <string> python_code: "";
    in property <string> execution_result: "";
    in property <[string]> execution_history: [];
    in property <[string]> template_list: [];
    in property <string> python_info: "";
    
    background: white;
    
    HorizontalLayout {
        padding: 0px;
        
        // å·¦ä¾§æ¨¡æ¿å’ŒåŽ†å²
        Rectangle {
            width: 300px;
            background: #f8fafc;
            border-width: 1px;
            border-color: #e2e8f0;
            
            VerticalLayout {
                padding: 16px;
                spacing: 16px;
                
                // Pythonä¿¡æ¯
                GroupBox {
                    title: "Python çŽ¯å¢ƒ";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        Rectangle {
                            height: 60px;
                            background: #f1f5f9;
                            border-radius: 6px;
                            
                            VerticalLayout {
                                padding: 12px;
                                spacing: 4px;
                                
                                Text {
                                    text: "Python 3.9+";
                                    font-size: 14px;
                                    font-weight: 600;
                                    color: #374151;
                                }
                                
                                Text {
                                    text: "PyO3 é›†æˆ";
                                    font-size: 12px;
                                    color: #6b7280;
                                }
                            }
                        }
                        
                        Button {
                            text: "èŽ·å–çŽ¯å¢ƒä¿¡æ¯";
                            clicked => {
                                root.get_python_info();
                            }
                        }
                    }
                }
                
                // è„šæœ¬æ¨¡æ¿
                GroupBox {
                    title: "è„šæœ¬æ¨¡æ¿";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        ScrollView {
                            height: 200px;
                            
                            ListView {
                                for template[index] in root.template_list: Rectangle {
                                    height: 36px;
                                    background: white;
                                    border-radius: 4px;
                                    border-width: 1px;
                                    border-color: #e5e7eb;
                                    
                                    HorizontalLayout {
                                        padding: 8px;
                                        spacing: 8px;
                                        
                                        Rectangle {
                                            width: 20px;
                                            height: 20px;
                                            background: #3b82f6;
                                            border-radius: 3px;
                                            
                                            Text {
                                                text: "ðŸ";
                                                font-size: 10px;
                                                horizontal-alignment: center;
                                                vertical-alignment: center;
                                            }
                                        }
                                        
                                        Text {
                                            text: template;
                                            font-size: 13px;
                                            color: #374151;
                                            vertical-alignment: center;
                                        }
                                    }
                                    
                                    TouchArea {
                                        clicked => {
                                            root.load_python_template(template);
                                        }
                                    }
                                }
                            }
                        }
                        
                        Button {
                            text: "åˆ·æ–°æ¨¡æ¿";
                            clicked => {
                                root.get_python_templates();
                            }
                        }
                    }
                }
                
                // æ‰§è¡ŒåŽ†å²
                GroupBox {
                    title: "æ‰§è¡ŒåŽ†å²";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        ScrollView {
                            height: 150px;
                            
                            ListView {
                                for history[index] in root.execution_history: Rectangle {
                                    height: 30px;
                                    background: #f9fafb;
                                    border-radius: 4px;
                                    
                                    HorizontalLayout {
                                        padding: 8px;
                                        
                                        Text {
                                            text: history;
                                            font-size: 12px;
                                            color: #6b7280;
                                            vertical-alignment: center;
                                        }
                                    }
                                }
                            }
                        }
                        
                        Button {
                            text: "æ¸…ç©ºåŽ†å²";
                            clicked => {
                                root.clear_python_history();
                            }
                        }
                    }
                }
            }
        }
        
        // å³ä¾§ä»£ç ç¼–è¾‘å™¨
        Rectangle {
            background: white;
            
            VerticalLayout {
                padding: 24px;
                spacing: 20px;
                
                // æ ‡é¢˜æ 
                HorizontalLayout {
                    Text {
                        text: "Python è„šæœ¬ç¼–è¾‘å™¨";
                        font-size: 24px;
                        font-weight: 700;
                        color: #111827;
                    }
                    
                    Rectangle { } // å¼¹æ€§ç©ºé—´
                    
                    HorizontalLayout {
                        spacing: 12px;
                        
                        Button {
                            text: "è¿è¡Œä»£ç ";
                            primary: true;
                            clicked => {
                                root.execute_python_code(root.python_code);
                            }
                        }
                        
                        Button {
                            text: "è¿è¡Œæ–‡ä»¶";
                            clicked => {
                                root.execute_python_file("script.py");
                            }
                        }
                    }
                }
                
                // ä»£ç ç¼–è¾‘åŒºåŸŸ
                GroupBox {
                    title: "Python ä»£ç ";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        ScrollView {
                            height: 300px;
                            
                            Rectangle {
                                background: #1e293b;
                                border-radius: 8px;
                                
                                VerticalLayout {
                                    padding: 16px;
                                    
                                    Text {
                                        text: root.python_code != "" ? root.python_code : "# åœ¨æ­¤è¾“å…¥ Python ä»£ç \n# ç¤ºä¾‹ï¼š\nprint('Hello, Rçƒç¼–è¾‘å™¨!')\n\n# è®¿é—®ç¼–è¾‘å™¨æ•°æ®\n# items = editor.get_items()\n# for item in items:\n#     print(f'ç‰©å“: {item.name}')";
                                        font-size: 14px;
                                        font-family: "Courier New";
                                        color: #e2e8f0;
                                        wrap: word-wrap;
                                    }
                                }
                            }
                        }
                        
                        HorizontalLayout {
                            spacing: 12px;
                            
                            Button {
                                text: "æ¸…ç©ºä»£ç ";
                                clicked => {
                                    // TODO: æ¸…ç©ºä»£ç 
                                }
                            }
                            
                            Button {
                                text: "æ ¼å¼åŒ–";
                                clicked => {
                                    // TODO: æ ¼å¼åŒ–ä»£ç 
                                }
                            }
                            
                            Button {
                                text: "è¯­æ³•æ£€æŸ¥";
                                clicked => {
                                    // TODO: è¯­æ³•æ£€æŸ¥
                                }
                            }
                        }
                    }
                }
                
                // æ‰§è¡Œç»“æžœ
                GroupBox {
                    title: "æ‰§è¡Œç»“æžœ";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        ScrollView {
                            height: 200px;
                            
                            Rectangle {
                                background: #f8fafc;
                                border-radius: 6px;
                                border-width: 1px;
                                border-color: #e2e8f0;
                                
                                VerticalLayout {
                                    padding: 12px;
                                    
                                    Text {
                                        text: root.execution_result != "" ? root.execution_result : "æ‰§è¡Œç»“æžœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...";
                                        font-size: 13px;
                                        font-family: "Courier New";
                                        color: root.execution_result != "" ? #374151 : #9ca3af;
                                        wrap: word-wrap;
                                    }
                                }
                            }
                        }
                    }
                }
                
                // å¿«æ·æ“ä½œ
                GroupBox {
                    title: "å¿«æ·æ“ä½œ";
                    
                    VerticalLayout {
                        spacing: 16px;
                        
                        HorizontalLayout {
                            spacing: 12px;
                            
                            Button {
                                text: "æ‰¹é‡å¤„ç†ç‰©å“";
                                clicked => {
                                    root.load_python_template("æ‰¹é‡å¤„ç†ç‰©å“");
                                }
                            }
                            
                            Button {
                                text: "å…µç§æ•°æ®åˆ†æž";
                                clicked => {
                                    root.load_python_template("å…µç§æ•°æ®åˆ†æž");
                                }
                            }
                            
                            Button {
                                text: "æ•°æ®å¯¼å‡º";
                                clicked => {
                                    root.load_python_template("æ•°æ®å¯¼å‡º");
                                }
                            }
                        }
                        
                        HorizontalLayout {
                            spacing: 12px;
                            
                            Button {
                                text: "æ•°æ®éªŒè¯";
                                clicked => {
                                    root.load_python_template("æ•°æ®éªŒè¯");
                                }
                            }
                            
                            Button {
                                text: "ç»Ÿè®¡æŠ¥å‘Š";
                                clicked => {
                                    root.load_python_template("ç»Ÿè®¡æŠ¥å‘Š");
                                }
                            }
                            
                            Button {
                                text: "è‡ªå®šä¹‰è„šæœ¬";
                                clicked => {
                                    root.load_python_template("è‡ªå®šä¹‰è„šæœ¬");
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
