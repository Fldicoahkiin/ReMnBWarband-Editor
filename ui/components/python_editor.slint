import { Button, VerticalBox, HorizontalBox, LineEdit, ComboBox, ScrollView, GroupBox, ListView } from "std-widgets.slint";

export component PythonEditor inherits Rectangle {
    // 回调函数
    callback execute_python_code(string) -> string;
    callback execute_python_file(string) -> string;
    callback get_python_templates() -> [string];
    callback clear_python_history();
    callback get_python_info() -> string;
    callback load_python_template(string);
    
    // 属性
    in property <string> python_code: "";
    in property <string> execution_result: "";
    in property <[string]> execution_history: [];
    in property <[string]> template_list: [];
    in property <string> python_info: "";
    
    background: white;
    
    HorizontalLayout {
        padding: 0px;
        
        // 左侧模板和历史
        Rectangle {
            width: 300px;
            background: #f8fafc;
            border-width: 1px;
            border-color: #e2e8f0;
            
            VerticalLayout {
                padding: 16px;
                spacing: 16px;
                
                // Python信息
                GroupBox {
                    title: "Python 环境";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        Rectangle {
                            height: 60px;
                            background: #f1f5f9;
                            border-radius: 6px;
                            
                            VerticalLayout {
                                padding: 12px;
                                spacing: 4px;
                                
                                Text {
                                    text: "Python 3.9+";
                                    font-size: 14px;
                                    font-weight: 600;
                                    color: #374151;
                                }
                                
                                Text {
                                    text: "PyO3 集成";
                                    font-size: 12px;
                                    color: #6b7280;
                                }
                            }
                        }
                        
                        Button {
                            text: "获取环境信息";
                            clicked => {
                                root.get_python_info();
                            }
                        }
                    }
                }
                
                // 脚本模板
                GroupBox {
                    title: "脚本模板";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        ScrollView {
                            height: 200px;
                            
                            ListView {
                                for template[index] in root.template_list: Rectangle {
                                    height: 36px;
                                    background: white;
                                    border-radius: 4px;
                                    border-width: 1px;
                                    border-color: #e5e7eb;
                                    
                                    HorizontalLayout {
                                        padding: 8px;
                                        spacing: 8px;
                                        
                                        Rectangle {
                                            width: 20px;
                                            height: 20px;
                                            background: #3b82f6;
                                            border-radius: 3px;
                                            
                                            Text {
                                                text: "🐍";
                                                font-size: 10px;
                                                horizontal-alignment: center;
                                                vertical-alignment: center;
                                            }
                                        }
                                        
                                        Text {
                                            text: template;
                                            font-size: 13px;
                                            color: #374151;
                                            vertical-alignment: center;
                                        }
                                    }
                                    
                                    TouchArea {
                                        clicked => {
                                            root.load_python_template(template);
                                        }
                                    }
                                }
                            }
                        }
                        
                        Button {
                            text: "刷新模板";
                            clicked => {
                                root.get_python_templates();
                            }
                        }
                    }
                }
                
                // 执行历史
                GroupBox {
                    title: "执行历史";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        ScrollView {
                            height: 150px;
                            
                            ListView {
                                for history[index] in root.execution_history: Rectangle {
                                    height: 30px;
                                    background: #f9fafb;
                                    border-radius: 4px;
                                    
                                    HorizontalLayout {
                                        padding: 8px;
                                        
                                        Text {
                                            text: history;
                                            font-size: 12px;
                                            color: #6b7280;
                                            vertical-alignment: center;
                                        }
                                    }
                                }
                            }
                        }
                        
                        Button {
                            text: "清空历史";
                            clicked => {
                                root.clear_python_history();
                            }
                        }
                    }
                }
            }
        }
        
        // 右侧代码编辑器
        Rectangle {
            background: white;
            
            VerticalLayout {
                padding: 24px;
                spacing: 20px;
                
                // 标题栏
                HorizontalLayout {
                    Text {
                        text: "Python 脚本编辑器";
                        font-size: 24px;
                        font-weight: 700;
                        color: #111827;
                    }
                    
                    Rectangle { } // 弹性空间
                    
                    HorizontalLayout {
                        spacing: 12px;
                        
                        Button {
                            text: "运行代码";
                            primary: true;
                            clicked => {
                                root.execute_python_code(root.python_code);
                            }
                        }
                        
                        Button {
                            text: "运行文件";
                            clicked => {
                                root.execute_python_file("script.py");
                            }
                        }
                    }
                }
                
                // 代码编辑区域
                GroupBox {
                    title: "Python 代码";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        ScrollView {
                            height: 300px;
                            
                            Rectangle {
                                background: #1e293b;
                                border-radius: 8px;
                                
                                VerticalLayout {
                                    padding: 16px;
                                    
                                    Text {
                                        text: root.python_code != "" ? root.python_code : "# 在此输入 Python 代码\n# 示例：\nprint('Hello, R球编辑器!')\n\n# 访问编辑器数据\n# items = editor.get_items()\n# for item in items:\n#     print(f'物品: {item.name}')";
                                        font-size: 14px;
                                        font-family: "Courier New";
                                        color: #e2e8f0;
                                        wrap: word-wrap;
                                    }
                                }
                            }
                        }
                        
                        HorizontalLayout {
                            spacing: 12px;
                            
                            Button {
                                text: "清空代码";
                                clicked => {
                                    // TODO: 清空代码
                                }
                            }
                            
                            Button {
                                text: "格式化";
                                clicked => {
                                    // TODO: 格式化代码
                                }
                            }
                            
                            Button {
                                text: "语法检查";
                                clicked => {
                                    // TODO: 语法检查
                                }
                            }
                        }
                    }
                }
                
                // 执行结果
                GroupBox {
                    title: "执行结果";
                    
                    VerticalLayout {
                        spacing: 12px;
                        
                        ScrollView {
                            height: 200px;
                            
                            Rectangle {
                                background: #f8fafc;
                                border-radius: 6px;
                                border-width: 1px;
                                border-color: #e2e8f0;
                                
                                VerticalLayout {
                                    padding: 12px;
                                    
                                    Text {
                                        text: root.execution_result != "" ? root.execution_result : "执行结果将显示在这里...";
                                        font-size: 13px;
                                        font-family: "Courier New";
                                        color: root.execution_result != "" ? #374151 : #9ca3af;
                                        wrap: word-wrap;
                                    }
                                }
                            }
                        }
                    }
                }
                
                // 快捷操作
                GroupBox {
                    title: "快捷操作";
                    
                    VerticalLayout {
                        spacing: 16px;
                        
                        HorizontalLayout {
                            spacing: 12px;
                            
                            Button {
                                text: "批量处理物品";
                                clicked => {
                                    root.load_python_template("批量处理物品");
                                }
                            }
                            
                            Button {
                                text: "兵种数据分析";
                                clicked => {
                                    root.load_python_template("兵种数据分析");
                                }
                            }
                            
                            Button {
                                text: "数据导出";
                                clicked => {
                                    root.load_python_template("数据导出");
                                }
                            }
                        }
                        
                        HorizontalLayout {
                            spacing: 12px;
                            
                            Button {
                                text: "数据验证";
                                clicked => {
                                    root.load_python_template("数据验证");
                                }
                            }
                            
                            Button {
                                text: "统计报告";
                                clicked => {
                                    root.load_python_template("统计报告");
                                }
                            }
                            
                            Button {
                                text: "自定义脚本";
                                clicked => {
                                    root.load_python_template("自定义脚本");
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
