// ReMnBWarband 编辑器主界面

import { AppBridge, UiState, WindowControlBridge } from "globals/bridges.slint";
import { Styles } from "globals/styles.slint";
import { StartupCard } from "components/startup-card.slint";
import { MainEditor } from "pages/main-editor.slint";
import { Notification } from "components/notification.slint";

export { AppBridge, UiState, WindowControlBridge }

// 核心数据结构
export struct GameInstance {
    id: string,
    name: string,
    path: string,
    version: string,
    status: string,
}

// 主窗口组件
export component MainWindow inherits Window {
    title: "ReMnBWarband 剧本编辑器";
    
    // 窗口属性
    min-width: 1000px;
    min-height: 700px;
    preferred-width: 1200px;
    preferred-height: 800px;
    
    // 背景
    background: Styles.background;
    
    // 通知状态
    property <bool> show-notification: false;
    property <string> notification-title: "";
    property <string> notification-message: "";
    property <string> notification-type: "info";
    
    // 主布局
    Rectangle {
        width: 100%;
        height: 100%;
        background: Styles.background;
        
        // 主编辑器
        MainEditor {
            width: 100%;
            height: 100%;
        }
        
        // 启动卡片覆盖层
        if UiState.startup-card-visible : StartupCard {
            width: 100%;
            height: 100%;
            
            collapse => {
                UiState.startup-card-visible = false;
            }
            
            detect-game => {
                AppBridge.detect-game();
                // 显示检测通知
                root.notification-title = "游戏检测";
                root.notification-message = "正在自动检测游戏安装路径...";
                root.notification-type = "info";
                root.show-notification = true;
            }
            
            browse-game-path => {
                AppBridge.browse-game-path();
            }
            
            enter-editor => {
                AppBridge.enter-editor();
                UiState.startup-card-visible = false;
                // 显示成功通知
                root.notification-title = "编辑器启动";
                root.notification-message = "成功进入编辑器，开始编辑您的剧本！";
                root.notification-type = "success";
                root.show-notification = true;
            }
        }
        
        // 通知覆盖层
        if show-notification : Notification {
            width: 100%;
            height: 100%;
            title: notification-title;
            message: notification-message;
            type: notification-type;
            show: show-notification;
            
            close => {
                root.show-notification = false;
            }
        }
    }
}
